summary:
  Tests for keylime rust agent

environment:
  TPM_BINARY_MEASUREMENTS: /var/tmp/binary_bios_measurements

context+:
  agent: rust

prepare:
  how: shell
  script:
   - rm -f /etc/yum.repos.d/tag-repository.repo

adjust:
  - when: distro == centos-stream-9
    prepare+:
       script+:
        - yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm
        - yum config-manager --set-enabled crb
  - when: distro == centos-stream-8
    enabled: false

discover:
  how: fmf
  test:
   - /setup/configure_tpm_emulator
   - /setup/install_upstream_keylime
   - /setup/install_upstream_rust_keylime
   - /setup/configure_kernel_ima_module/ima_policy_signing
   - /functional/basic-attestation-on-localhost
   - /functional/basic-attestation-with-custom-certificates
   - /functional/basic-attestation-without-mtls
   - /functional/basic-attestation-with-unpriviledged-agent
   - /functional/basic-attestation-with-ima-signatures
   - /functional/ek-cert-use-ek_check_script
   - /functional/ek-cert-use-ek_handle-custom-ca_certs   
   - /functional/keylime_tenant-commands-on-localhost
   - /functional/measured-boot-swtpm-sanity

execute:
    how: tmt
