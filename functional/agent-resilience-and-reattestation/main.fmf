summary: Tests keylime agent resilience and re-attestation scenarios
description: |
    Running all services on localhost.
    Uses certificates generated by keylime.
    Starts verifier, registrar, agent with revocation disabled.
    Registers agent with runtime policy (no payload).
    Verifies that system passed attestation.
    Tests agent restart - ensures agent can re-establish attestation with the verifier.
    Tests verifier restart - ensures agent remains attested after verifier service restart.
    Tests agent deletion from registrar and restart - ensures agent re-registers and attests.
    Tests agent removal and re-addition with updated policy - ensures agent attests with new policy.
    Verifies that agent fails attestation when it stops sending quotes.
contact: Karel Srot <ksrot@redhat.com>
component:
  - keylime
test: ./test.sh
framework: beakerlib
tag:
  - CI-Tier-1
require:
  - yum
recommend:
  - keylime
  - keylime-agent-rust-push
duration: 15m
enabled: true

/push:
    environment:
        AGENT_SERVICE: PushAgent
/pull:
    environment:
        AGENT_SERVICE: Agent
