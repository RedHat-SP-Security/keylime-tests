summary: System upgrade test implementing basic attestation scenario for agent container
description: |
    Pre-upgrade phase:
      Running only verifier and registrar on localhost. Agents run in containers.
      Uses certificates generated by keylime.
      Starts verifier, registrar on localhost.
      Build container image with agent. 
      Setup agent conf for container.
      Run container with agent.
      Register agent by verifier.
      Verifiers that container passed with agent attestation.
      Stops all services.
    Post-upgrade scenario:
      Starts all services.
      Starts agent container and verifies it passes attestation
contact: Karel Srot <ksrot@redhat.com>
tag:
  - container
component:
  - keylime
test: ./test.sh
framework: beakerlib
require:
  - yum
  - podman
recommend:
  - keylime
duration: 10m
enabled: true

adjust:
  - when: swtpm != yes
    enabled: false
    because: We need to emulate multiple TPM device with swtpm

/all:
    environment:
        PHASES: all

/setup:
    environment:
        PHASES: setup

/test:
    environment:
        PHASES: test
