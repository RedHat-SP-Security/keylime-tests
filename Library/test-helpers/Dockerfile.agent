FROM quay.io/centos/centos:stream9
RUN dnf install -y keylime-agent-rust util-linux-core openssh-server && dnf clean all
COPY cacert.crt /var/lib/keylime/cv_ca/
RUN chmod o+r /var/lib/keylime/cv_ca/cacert.crt
RUN ssh-keygen -A && mkdir -p /root/.ssh
COPY id_*.pub /root/
RUN cat /root/id_*.pub > /root/.ssh/authorized_keys && chmod 700 /root/.ssh/authorized_keys
COPY lime_con_start.sh /usr/local/bin/lime_con_start
RUN chmod a+x /usr/local/bin/lime_con_start
